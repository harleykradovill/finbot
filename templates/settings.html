<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Borealis | Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
</head>
<body>
  <header class="navbar" role="banner" aria-label="Primary">
    <nav class="nav-container" role="navigation" aria-label="Main">
      <a class="brand" href="/" aria-label="Borealis Home">
        <img src="{{ url_for('assets', filename='images/borealis_small.png') }}"
             alt="Borealis logo" class="brand-logo">
        <span class="brand-text">Borealis</span>
      </a>
      <ul class="nav-links">
        {% set is_home = request.path == url_for('index') %}
        {% set is_users = request.path == url_for('users') %}
        {% set is_libraries = request.path == url_for('libraries') %}
        {% set is_settings = request.path == url_for('settings') %}
        <li><a href="/" class="{{ 'active' if is_home else '' }}">Home</a></li>
        <li><a href="/users" class="{{ 'active' if is_users else '' }}">Users</a></li>
        <li><a href="/libraries" class="{{ 'active' if is_libraries else '' }}">Libraries</a></li>
        <li><a href="/settings" class="{{ 'active' if is_settings else '' }}">Settings</a></li>
      </ul>
    </nav>
  </header>

  <main id="content" class="content" tabindex="-1">
    {% block content %}{% endblock %}

    <section class="settings-shell" aria-label="Settings">
      <div class="settings-container" role="tablist" aria-orientation="vertical">
        <nav class="settings-nav" aria-label="Sections">
          <a id="general-tab" href="#general" class="settings-tab active" role="tab" aria-selected="true" aria-controls="general" tabindex="0">
            General
          </a>
          <a id="jellyfin-tab" href="#jellyfin" class="settings-tab" role="tab" aria-selected="false" aria-controls="jellyfin" tabindex="-1">
            Jellyfin
          </a>
          <a id="libraries-tab" href="#libraries" class="settings-tab" role="tab" aria-selected="false" aria-controls="libraries" tabindex="-1">
            Libraries
          </a>
          <a id="about-tab" href="#about" class="settings-tab" role="tab" aria-selected="false" aria-controls="about" tabindex="-1">
            About
          </a>
        </nav>

        <div class="settings-content" role="tabpanel" id="general" aria-labelledby="general-tab">
          <div class="settings-placeholder">
            <h2 class="placeholder-title">General</h2>
          </div>

          <form class="settings-form" aria-label="General Settings">
            <div class="form-field">
              <label for="hour-format">Hour Format</label>
              <select id="hour-format" name="hour_format">
                <option value="12">12 Hours</option>
                <option value="24">24 Hours</option>
              </select>
            </div>

            <div class="form-field">
              <label for="language">Language</label>
              <select id="language" name="language">
                <option value="en">English</option>
              </select>
            </div>
          </form>
        </div>

        <div class="settings-content" role="tabpanel" id="jellyfin" aria-labelledby="jellyfin-tab" hidden>
          <div class="settings-placeholder">
            <h2 class="placeholder-title">Jellyfin</h2>
          </div>

          <div id="jf-no-server" class="jf-server-container" aria-label="Add Jellyfin Server">
            <p>You do not have a server added yet.</p>
            <button id="jf-add-server-btn" class="btn" type="button">
              Add Server
            </button>
          </div>

          <div id="jf-server-added" class="jf-server-container" hidden>
            <div class="jf-server-info">
              <div class="jf-server-details">
                <div class="jf-server-host" id="jf-server-host-display">
                  127.0.0.1:8096
                </div>
                <div class="jf-server-key" id="jf-server-key-display">
                  API Key: ••••••••••••••••
                </div>
              </div>
              <button id="jf-remove-server-btn" class="btn btn-danger" type="button">
                Remove Server
              </button>
            </div>

            <div id="jf-sync-progress" class="jf-sync-progress" hidden>
              <div class="jf-sync-info">
                <p id="jf-sync-text">Performing initial sync</p>
              </div>
            </div>
          </div>

          <div class="jf-debug-actions" aria-label="Jellyfin Debug Tools">
            <button type="button" class="btn" id="jf-test-connection-btn">
              Test Connection
            </button>
            <button type="button" class="btn" id="jf-test-sysinfo-btn">
              Test SystemInfo
            </button>
          </div>
        </div>

        <div id="jf-modal-backdrop" class="modal-backdrop" hidden aria-hidden="true"></div>
        <div id="jf-add-server-modal" class="modal" hidden role="dialog" 
             aria-labelledby="jf-modal-title" aria-modal="true">
          <div class="modal-content">
            <div class="modal-header">
              <h3 id="jf-modal-title">Add Jellyfin Server</h3>
              <button id="jf-modal-close" class="icon-btn" aria-label="Close dialog">
                ×
              </button>
            </div>

            <form id="jf-modal-form" class="settings-form">
              <div class="form-field" style="grid-column: 1 / -1;">
                <label for="jf-modal-host">Host</label>
                <input id="jf-modal-host" type="text" inputmode="url" 
                       placeholder="127.0.0.1 or example.com" required>
              </div>

              <div class="form-field" style="grid-column: 1 / -1;">
                <label for="jf-modal-port">Port</label>
                <input id="jf-modal-port" type="text" inputmode="numeric" 
                       placeholder="8096" required>
              </div>

              <div class="form-field" style="grid-column: 1 / -1;">
                <label for="jf-modal-api-key">API Key</label>
                <input id="jf-modal-api-key" type="text" autocomplete="off" 
                       placeholder="Paste your API key" required>
              </div>

              <div class="modal-actions" style="grid-column: 1 / -1;">
                <button type="button" id="jf-modal-test-btn" class="btn">
                  Test Connection
                </button>
                <button type="submit" id="jf-modal-add-btn" class="btn">
                  Add Server
                </button>
              </div>
            </form>
          </div>
        </div>

        <div class="settings-content" role="tabpanel" id="libraries" aria-labelledby="libraries-tab" hidden>
          <div class="settings-placeholder">
            <h2 class="placeholder-title">Libraries</h2>
          </div>

          <div id="libraries-panel" class="settings-content" role="region" aria-label="Analytics Libraries">
            <div id="libraries-empty" class="settings-placeholder" hidden>
              <p>No libraries found.</p>
              <p>Fetch libraries from Jellyfin and then manage tracking here.</p>
            </div>

            <ul id="libraries-list" class="libraries-list" aria-labelledby="libraries-help" aria-label="Library items"></ul>
          </div>
        </div>

        <div class="settings-content" role="tabpanel" id="about" aria-labelledby="about-tab" hidden>
          <div class="settings-placeholder">
            <h2 class="placeholder-title">About</h2>
          </div>
          <div class="about-list" aria-label="About Borealis">
            <p><strong>Borealis Version:</strong> <span id="borealis-version">0.1.0</span></p>
            <p><strong>Latest Borealis Version:</strong> <span id="borealis-latest">0.1.0</span></p>
            <p>
              <strong>Repository:</strong>
              <a href="https://github.com/harleykradovill/borealis" target="_blank" rel="noopener noreferrer">
                github.com/harleykradovill/borealis
              </a>
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="toast-container"
       class="toast-container"
       role="status"
       aria-live="polite"
       aria-atomic="true"></div>

  <script src="../static/js/settings.js"></script>

</body>
</html>